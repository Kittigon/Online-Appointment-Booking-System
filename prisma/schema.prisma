generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model users {
  id            Int              @id @default(autoincrement())
  email         String           @unique
  password      String
  name          String
  age           Int?
  gender        String?
  role          Role             @default(USER)
  createdAt     DateTime         @default(now())
  updateAt      DateTime         @default(now())
  code          String?
  phone         String?
  notifications Notifications[]
  appointments  appointments[]
  reports       reportproblems[]
}

model appointments {
  id            Int             @id @default(autoincrement())
  userId        Int
  date          String
  time          String
  description   String?
  status        Status          @default(PENDING)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @default(now())
  code          String
  phone         String
  name          String
  cancelReason  String?
  title         String          @default("นัดหมายเข้าปรึกษาผู้เชี่ยวชาญด้านสุขภาพจิต")
  notifications Notifications[]
  user          users           @relation(fields: [userId], references: [id])
}

model dass_21_result {
  id               Int             @id @default(autoincrement())
  user_id          String?         @db.VarChar(100)
  depression_score Int?
  anxiety_score    Int?
  stress_score     Int?
  depression_level String?
  anxiety_level    String?
  stress_level     String?
  created_at       DateTime?       @default(now()) @db.Timestamp(6)
  notifications    Notifications[]
  user_consent     user_consent?   @relation(fields: [user_id], references: [line_user_id], onDelete: Cascade, onUpdate: NoAction)
}

model documents {
  id        Int                    @id @default(autoincrement())
  content   String?
  embedding Unsupported("vector")?
}

// For handling document processing jobs
model DocumentJob {
  id        String   @id @default(uuid())
  status    String   @default("PENDING") // PENDING | PROCESSING | DONE | ERROR
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model reportproblems {
  id            Int             @id @default(autoincrement())
  userId        Int
  type          String
  description   String?
  status        Reportstatus    @default(NEW)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @default(now())
  notifications Notifications[]
  user          users           @relation(fields: [userId], references: [id])
}

model chat_history {
  id           Int          @id @default(autoincrement())
  line_user_id String       @db.VarChar(100)
  role         String
  content      String
  timestamp    DateTime?    @default(now()) @db.Timestamptz(6)
  user_consent user_consent @relation(fields: [line_user_id], references: [line_user_id], onDelete: Cascade, onUpdate: NoAction)
}

model user_consent {
  line_user_id   String           @id @db.VarChar(100)
  name           String?
  phone          String?
  student_id     String?          @db.VarChar(20)
  consent        Boolean?
  granted_at     DateTime?        @db.Timestamp(6)
  allow_greeting Boolean?         @default(false)
  last_greeted   DateTime?        @db.Timestamp(6)
  tone_style     String?          @default("friendly") @db.VarChar(20)
  notifications  Notifications[]
  chat_history   chat_history[]
  dass_21_result dass_21_result[]
}

model DisabledDate {
  id        Int      @id @default(autoincrement())
  date      String
  createdAt DateTime @default(now())
}

model Notifications {
  id            Int             @id @default(autoincrement())
  userId        Int?
  line_user_id  String?
  type          String
  title         String
  message       String
  isRead        Boolean         @default(false)
  createdAt     DateTime        @default(now())
  appointmentId Int?
  dass21Id      Int?
  reportId      Int?
  appointment   appointments?   @relation(fields: [appointmentId], references: [id])
  dass21        dass_21_result? @relation(fields: [dass21Id], references: [id])
  lineUser      user_consent?   @relation(fields: [line_user_id], references: [line_user_id], onDelete: Cascade)
  report        reportproblems? @relation(fields: [reportId], references: [id])
  user          users?          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Holiday {
  id        Int         @id @default(autoincrement())
  date      String      @unique
  name      String
  type      HolidayType
  createdAt DateTime    @default(now())
}

enum Reportstatus {
  NEW
  IN_PROGRESS
  RESOLVED
  CANCELLED
}

enum Role {
  USER
  ADMIN
  MENTALHEALTH
}

enum Status {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum HolidayType {
  NATIONAL
  RELIGIOUS
  SPECIAL
  OTHER
}
